<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
	<meta http-equiv="content-type" content="text/html; charset=UTF-8" />
	<title>DryValidatorのブラウザテスト</title>
	<script type="text/javascript">var dryValidatorModuleName="DV";</script>
	<script type="text/javascript" src="jquery.js"></script>
	<script type="text/javascript" src="../../../src/main/resources/com/google/codes/dryvalidator/joose.js"></script>
	<script type="text/javascript" src="../../../src/main/resources/com/google/codes/dryvalidator/dry-validator.js"></script>
</head>
<body>
	<h1>Test</h1>
	<div id="messageArea">
	</div>
	<form id="sampleForm">
		<table summary="person">
			<tr>
				<th>氏名</th>
				<td>氏<input type="text" name="familyName"/>名<input type="text" name="firstName"/></td>
			</tr>
		</table>
		<button type="button" id="doValidate">Validate It</button>
	</form>
	<script type="text/javascript">
<!--
$(document).ready(function() {
	var xml = '<pageItem><id>familyName</id><label>氏名</label><validations><validation><name>required</name><value>true</value></validation>'
		+ '<validation><name>maxLength</name><value>10</value></validation>'
		+ '<validation><name>letterType</name><value>Zenkaku</value></validation>'
		+ '<validation><name>function</name><value>if(true) { return ["特別なチェック"]}</value></validation>'
		+ '</validations></pageItem>';

	var xmlDoc;
	if(window.DOMParser) {
		xmlDoc = new DOMParser().parseFromString(xml, 'text/xml');
	} else {
		xmlDoc = new ActiveXObject("Microsoft.XMLDOM");
		xmlDoc.async = false;
		xmlDoc.loadXML(xml);
	}

	var validators = {};
	var obj = DV.DOM.parseElement(xmlDoc);
	var validation = {label: obj.pageItem.label};
	Joose.A.each(obj.pageItem.validations.validation, function(v) { validation[v.name] = v.value; });
	validators[obj.pageItem.id] = DV.CompositeValidator.make(validation);

	$("#doValidate").click(function(){
		var form = new DV.Form().setup("sampleForm");
		var msg = form.validateAll(validators);

		var ul = $("<ul/>").appendTo($("#messageArea").empty());
		for(var key in msg) {
			for (var i=0; i<msg[key].length; i++) {
				$("<li/>").text(msg[key][i]).appendTo(ul);
			}
		}
	});
});
--></script>
</body>
</html>